<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WVQ53GG33W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WVQ53GG33W');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A website that offers free PYQ as mock test for jee mains , jee advance , mhtcet exams in interactive CBT format that exactly matches the official NTA CBT format.">
<meta name="keywords" content="JEE,CBT,JEE MAINS CBT,CBT INTERFACE,MOCK TEST,MOCK,CBT,COMPUTER BASED TEST,NTA,JEE MAINS,JEE ADVANCE,MHTCET,PYQ MOCK TEST,PYQ,TEST,PYQ CBT,">
<meta name="robots" content="index, follow">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="language" content="English">
<title>Dashboard</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400..700&family=Elsie+Swash+Caps:wght@400;900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #161616;
    }

    nav {
      position: fixed;
      background: #a0a0a015;
      -webkit-backdrop-filter: blur(15px);
      backdrop-filter: blur(15px);
      height: 9vh;
      justify-content: center;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 15px;
      width: 90vw;
      margin-left: 4vw;
      top: 4vmin;
      z-index: 9;
    }

    .sitelogo {
      margin-left: -15px;
      margin-top: 15px;
      display: inline;
    }

    .jeemainlogo {
      margin-right: 23px
    }

    .jeequiz {
      color: #fff;
      text-decoration: none;
      display: flex;
      font-family: "El Messiri", system-ui;
      transition: color 0.3s ease-in-out;
      position: relative;
      text-align: center;
      right: 20px;
    }

    .jeequiz:hover::after {
      width: 76%;
    }

    .jeequiz::after {
      content: "";
      position: absolute;
      left: 38px;
      bottom: 21px;
      width: 0;
      height: 2px;
      background-color: #00ff00;
      transition: width 0.3s ease-in-out;
    }

    .jeequiz>img {
      padding-right: 15px;
    }

    #welcome-container {
      display: flex;
      margin-top: 150px;
      margin-left: 78px;
    }

    #welcome-message {
      font-family: "El Messiri", system-ui;
      color: rgb(249, 252, 255);
      font-size: 40px;
      margin-right: 20px;
    }

    #new-sections-container {
      display: flex;
      flex-direction: row;
      height: 85vh;
      justify-content: space-between;
      margin-top: 50px;
      padding: 50px;
      
      
    }

    #section1 {
      flex: 1;
      font-family: "El Messiri", system-ui;
      padding: 20px;
      box-sizing: border-box;
      background-color: #282828;
      color: #fff;
      margin: 10px;
      border-radius: 10px;
      font-size:25px;
    }

    #section2 {
      flex: 1;
      font-family: "El Messiri", system-ui;
      padding: 20px;
      box-sizing: border-box;
      background-color: #282828;
      color: #fff;
      margin: 10px;
      border-radius: 10px;
      font-size:25px;
    }

    .row {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .logo {
      width: 70px;
      height: auto;
      margin-left: 25px;
      margin-top: 10px;
    }

    .text-container {
      flex: 1;
      margin-left: auto;
      text-align: right;
    }

    .action-button {
      margin-top: -10px;
      padding: 10px 15px;
      background-color: #00ff00;
      border: none;
      border-radius: 5px;
      color: #000;
      cursor: pointer;
      margin-right: 40px;
    }

    .action-button:hover {
      background-color: #00cc00;
    }

    .separator {
      border: none;
      border-top: 1.5px solid #444;
      margin: 10px 0;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-family: "El Messiri", system-ui;
      font-size: 14px;
      margin-right: 20px;
      transition: background-color 0.3s ease;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    @media (max-width: 768px) {
      body {
        overflow-x: hidden;
      }

      .jeequiz {
        color: #fff;
        text-decoration: none;
        display: flex;
        font-family: "El Messiri", system-ui;
        font-size: 13px;
        transition: color 0.3s ease-in-out;
        position: relative;
        text-align: center;
        right: 20px;
        padding: 6px;
      }

      .jeequiz:hover::after {
        display: none;
      }

      .nav-links {
        display: none;
        flex-direction: column;
        width: 100%;
        position: absolute;
        top: 9vh;
        left: 0;
        background: #a0a0a015;
        border-radius: 0 0 10px 10px;
      }

      .nav-links a {
        padding: 100px;
        text-align: center;
        font-size: 6px;
      }

      .jeequiz img {
        display: none;
      }

      #welcome-container {
        display: flex;
        flex-direction: row;
        margin-top: 140px;
      }

      #welcome-message {
        font-family: "El Messiri", system-ui;
        color: rgb(249, 252, 255);
        font-size: 24px;
        margin-right: 10px;
        margin-left: -60px;
      }

      dotlottie-player {
        width: 150px;
        height: 150px;
      }

      #new-sections-container {
        flex-direction: column;
        padding: 20px;
        margin-top: 5px;
      }
      #section1{
        font-size: 20px;
      }

      .row {
        /* flex-direction: column; */
        align-items: flex-start;
        padding: 0px;
      }

      .logo {
        width: 70px;
        margin-top: 23px;
        margin-left: 15px;
        
      }
      .action-button{
        margin-right: 30px;
      }

      .logout-btn {
        padding: 6px 12px;
        font-size: 12px;
        margin-right: 10px;
      }
    }
  </style>
</head>

<body>

  <nav>
    <a href="dashboard.html">
      <img src="logo.png" alt="" width="140" class="sitelogo">
    </a>

    <a href="jeequiz.html" class="jeequiz">
      <img src="open-external-link-icon.svg" width="25px">
      <H2>JEE QUIZ</H2>
    </a>
    <a href="index.html" class="jeequiz">
      <img src="open-external-link-icon.svg" width="25px">
      <H2>JEE BOOKS</H2>
    </a>


    <button id="logout-btn" class="logout-btn">Logout</button>
  </nav>

  <div id="welcome-container">
    <h1 id="welcome-message"></h1>
    <dotlottie-player src="https://lottie.host/8c4740ee-df89-4afb-8a5b-4e6d11edb76f/dGDzygdJjP.lottie"
      background="transparent" speed="1" style="width: 150px; height: 150px;margin-top:-25px" loop
      autoplay></dotlottie-player>
  </div>

  <!-- New sections container -->
  <div id="new-sections-container">
    <section id="section1">
      <h2>Exams</h2>
      
      <div class="row">
        <img src="jee-main-150x150.png" alt="Logo 1" class="logo">
        <div class="text-container">
          <p> MAINS MOCK TEST</p>
          <button class="action-button" onclick="document.location='jeeshifts.html'" >START MOCK...</button>
        </div>
      </div>
      
      <hr class="separator">
      
      <div class="row">
        <img src="jeeadv.webp" alt="Logo 2" class="logo">
        <div class="text-container">
          <p>JEE ADV MOCK TEST</p>
          <button class="action-button">COMING SOON</button>
        </div>
      </div>
      
      <hr class="separator">
      
      <div class="row">
        <img src="MHT-CET_logo.png" alt="Logo 3" class="logo">
        <div class="text-container">
          <p>MHTCET  MOCK TEST</p>
          <button class="action-button">COMING SOON</button>
        </div>
      </div>
    </section>
    <section id="section2">
      <h2>Your Tests</h2>
      <div class="tests-container" style="
        position: relative;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 10px;
      ">
        <div id="recent-tests">
          <!-- Test results will be populated here -->
        </div>
      </div>
      <div class="scroll-buttons" style="
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
      ">
        <button onclick="scrollTests('up')" style="
          background: #00ff00;
          color: #000;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 5px;
        ">
          <span style="font-size: 20px;">↑</span> Previous
        </button>
        <button onclick="scrollTests('down')" style="
          background: #00ff00;
          color: #000;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 5px;
        ">
          Next <span style="font-size: 20px;">↓</span>
        </button>
      </div>
    </section>
  </div>

  <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC5iCxiWXEAiUSQAO6uBvG6bL4udqWIlNg",
      authDomain: "practiso-9b3dd.firebaseapp.com",
      projectId: "practiso-9b3dd",
      storageBucket: "practiso-9b3dd.appspot.com",
      messagingSenderId: "263842850217",
      appId: "1:263842850217:web:129de6a752bd8831b150b8",
      measurementId: "G-CG44V5WG0G"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const logoutBtn = document.getElementById('logout-btn');

    auth.onAuthStateChanged((user) => {
      if (user) {
        // User is signed in
        const email = user.email;
        document.getElementById('welcome-message').textContent = `WELCOME, ${email.toUpperCase()}`;
        
        logoutBtn.textContent = 'Logout';
        logoutBtn.className = 'logout-btn';
        logoutBtn.style.backgroundColor = '#dc3545';
        logoutBtn.style.color = 'white';
        logoutBtn.onclick = () => {
          auth.signOut().catch((error) => {
            console.error("Error signing out:", error);
          });
        };
        
        loadRecentTests();
        document.querySelector('.scroll-buttons').style.display = 'flex';

      } else {
        // User is not signed in
        document.getElementById('welcome-message').textContent = 'WELCOME';
        
        logoutBtn.textContent = 'Sign In';
        logoutBtn.className = 'logout-btn'; 
        logoutBtn.style.backgroundColor = '#00ff00';
        logoutBtn.style.color = '#000';
        logoutBtn.onclick = () => {
          window.location.href = `login.html?redirect=dashboard.html`;
        };

        const recentTestsContainer = document.getElementById('recent-tests');
        recentTestsContainer.innerHTML = `
          <div style="text-align: center;">
            <p style="color: #888;">Sign in to view your test history.</p>
          </div>
        `;
        document.querySelector('.scroll-buttons').style.display = 'none';
      }
    });

    async function loadRecentTests() {
      const recentTestsContainer = document.getElementById('recent-tests');
      const user = firebase.auth().currentUser;
      
      if (!user) {
        recentTestsContainer.innerHTML = '<p style="text-align: center; color: #888;">Please log in to view your tests</p>';
        return;
      }

      try {
        // Fetch test attempts from Firebase
        const testAttemptsRef = db.collection('user_test_responses')
          .doc(user.uid)
          .collection('test_attempts')
          .orderBy('submittedAt', 'desc')
          .limit(5);

        const snapshot = await testAttemptsRef.get();
        
        if (snapshot.empty) {
          recentTestsContainer.innerHTML = '<p style="text-align: center; color: #888;">No tests taken yet. <br>Go to the "Exams" section to start a new mock test!</p>';
          return;
        }

        // Clear existing content
        recentTestsContainer.innerHTML = '';

        // Process each test
        for (const doc of snapshot.docs) {
          const test = doc.data();
          const testDate = new Date(test.testInfo.startTime);
          const formattedDate = testDate.toLocaleDateString();
          const formattedTime = testDate.toLocaleTimeString();
          
          // Calculate total score
          let totalScore = 0;
          
          // Process each section
          for (const [sectionKey, sectionData] of Object.entries(test.sections)) {
            const [subject, section] = sectionKey.split('-');
            const firstQuestionId = sectionData.questions[0]?.questionId;
            const isNumerical = firstQuestionId && parseInt(firstQuestionId.substring(1)) > 20;
            const sectionNumber = isNumerical ? '2' : '1';
            const sectionType = isNumerical ? 'num' : 'mcq';
            const fullSection = `sec-${sectionNumber}-${sectionType}`;
            
            try {
              console.log('Fetching answers for:', {
                year: test.testInfo.year,
                month: test.testInfo.month,
                shift: test.testInfo.shift,
                subject,
                section: fullSection
              });

              // Fetch correct answers from Firebase
              const path = `years/${test.testInfo.year}/${test.testInfo.month}/${test.testInfo.shift}/subjects/${subject}/sections/${fullSection}/questions`;
              const questionsSnapshot = await db.collection(path).get();
              
              if (questionsSnapshot.empty) {
                console.error('No questions found at path:', path);
                continue;
              }
              
              // Create a map of correct answers
              const correctAnswers = {};
              questionsSnapshot.forEach(doc => {
                correctAnswers[doc.id] = doc.data().correct;
              });
              
              console.log('Correct answers:', correctAnswers);
              
              // Calculate section score
              let sectionScore = 0;
              sectionData.questions.forEach(question => {
                const userResponse = question.response;
                const correctAnswer = correctAnswers[question.questionId];
                
                console.log('Processing question:', {
                  questionId: question.questionId,
                  userResponse,
                  correctAnswer,
                  isNumerical
                });
                
                if (!userResponse) {
                  // Question was not attempted
                  return;
                }
                
                if (isNumerical) {
                  // For numerical questions
                  const userNum = parseFloat(userResponse);
                  const correctNum = parseFloat(correctAnswer);
                  
                  console.log('Numerical comparison:', {
                    userNum,
                    correctNum,
                    isEqual: Math.abs(userNum - correctNum) < 0.0001
                  });
                  
                  if (!isNaN(userNum) && !isNaN(correctNum)) {
                    // Compare with a small tolerance for floating point numbers
                    const isEqual = Math.abs(userNum - correctNum) < 0.0001;
                    if (isEqual) {
                      sectionScore += 4;
                    } else {
                      sectionScore -= 1;
                    }
                  } else {
                    sectionScore -= 1;
                  }
                } else {
                  // For MCQ questions
                  const userResponseNum = userResponse.charCodeAt(0) - 64; // A->1, B->2, etc.
                  const correctAnswerNum = parseInt(correctAnswer);
                  
                  console.log('MCQ comparison:', {
                    userResponseNum,
                    correctAnswerNum,
                    isEqual: userResponseNum === correctAnswerNum
                  });
                  
                  if (userResponseNum === correctAnswerNum) {
                    sectionScore += 4;
                  } else {
                    sectionScore -= 1;
                  }
                }
              });
              
              console.log('Section score:', sectionScore);
              totalScore += sectionScore;
            } catch (error) {
              console.error('Error calculating section score:', error);
              console.error('Error details:', {
                message: error.message,
                stack: error.stack,
                code: error.code
              });
            }
          }

          console.log('Total score:', totalScore);

          // Create test result element
          const testResult = document.createElement('div');
          testResult.className = 'test-result';
          testResult.style.cssText = `
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          `;
          
          testResult.innerHTML = `
            <div class="test-info" style="flex: 1;">
              <h3 style="margin: 0 0 5px 0; color: #00ff00;">${test.testInfo.shift}</h3>
              <p style="margin: 0; color: #aaa;">Date: ${formattedDate}</p>
              <p style="margin: 0; color: #aaa;">Time: ${formattedTime}</p>
              <p style="margin: 5px 0 0 0; color: #fff; font-size: 1.2em;">Score: ${totalScore}</p>
            </div>
            <button onclick="viewTestAnalysis('${doc.id}')" style="
              background: #00ff00;
              color: #000;
              border: none;
              padding: 8px 15px;
              border-radius: 5px;
              cursor: pointer;
              font-weight: bold;
            ">View Analysis</button>
          `;
          
          recentTestsContainer.appendChild(testResult);
        }
      } catch (error) {
        console.error('Error loading tests:', error);
        recentTestsContainer.innerHTML = '<p style="text-align: center; color: #ff0000;">Error loading tests. Please try again later.</p>';
      }
    }

    function viewTestAnalysis(testId) {
      // Store the selected test ID in localStorage
      localStorage.setItem('selected_test_id', testId);
      // Redirect to results page
      window.location.href = 'results.html';
    }

    function scrollTests(direction) {
      const container = document.querySelector('.tests-container');
      const scrollAmount = 200; // pixels to scroll
      
      if (direction === 'up') {
        container.scrollTop -= scrollAmount;
      } else {
        container.scrollTop += scrollAmount;
      }
    }

    // Add logout functionality - This logic is now handled in onAuthStateChanged
    /* document.getElementById('logout-btn').addEventListener('click', () => {
      auth.signOut().then(() => {
        window.location.href = "/login.html";
      }).catch((error) => {
        console.error("Error signing out:", error);
      });
    }); */
  </script>

  </div>

</body>

</html>
